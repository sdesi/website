---
// src/pages/index.astro

import MainLayout from "../layouts/MainLayout.astro";
import { projects } from "../data/projects";

// базовый префикс для GitHub Pages ("/" локально, "/portfolio-main/" в проде)
const base = import.meta.env.BASE_URL;

// Человекочитаемые подписи для категорий
const CATEGORY_LABELS = {
  all: "Всё",
  graphic: "Графический дизайн",
  navigation: "Навигация",
  "3d": "3D",
} as const;

// Собираем уникальные категории из данных
const allCategories = Array.from(
  new Set(projects.flatMap((p) => p.categories))
).sort();
---

<MainLayout title="Портфолио" hideScrollbar={true}>

  <!-- ОДНА кнопка + выпадающий список -->
  <section class="filter">
    <div class="cart">
      <img src={`${base}icon-cart.svg`} alt="" class="cart-cart-icon" />
      <img src={`${base}icon-ruble.svg`} alt="" class="cart-ruble-icon" />
    </div>

    <div class="filter-dropdown">
      <button
        class="filter-toggle"
        type="button"
        data-current-filter="all"
      >
        <img src={`${base}icon-search.svg`} alt="" class="filter-toggle-icon" />
        <span class="filter-toggle-label">Графический дизайн</span>
      </button>

      <div class="filter-menu">
        <button
          class="filter-option active"
          type="button"
          data-filter="all"
        >
          Графический дизайн
        </button>

        {allCategories.map((cat) => (
          <button
            class="filter-option"
            type="button"
            data-filter={cat}
          >
            {cat}
          </button>
        ))}
      </div>
    </div>
  </section>

  <!-- Сетка проектов -->
  <section class="projects-grid">
    {projects.map((project) => (
      <article
        class="project-card"
        data-categories={project.categories.join(",")}
      >
        <a href={`${base}projects/${project.slug}/`} class="project-link">
          <div class="project-image-wrapper">
            <img
              src={`${base}${project.cover}`}
              alt={project.title}
              class="project-cover"
            />
          </div>

          <div class="project-text">
            <div class="project-description">
              <img
                src={`${base}icon-info.svg`}
                alt=""
                class="project-info-icon"
              />
              {project.short}
            </div>
            <div class="project-title">
              {project.title}
            </div>
          </div>
        </a>
      </article>
    ))}
  </section>

  <script src={`${base}js/filter.js`} defer></script>
</MainLayout>
